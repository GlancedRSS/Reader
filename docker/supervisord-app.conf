[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/run/supervisord/supervisord.pid
childlogdir=/logs
user=appuser

[program:backend]
command=/venv/bin/python -m uvicorn backend.main:app --host 0.0.0.0 --port 2076
directory=/server
user=appuser
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stdout_logfile=/logs/backend.log
stderr_logfile=/logs/backend.err
environment=PATH="/venv/bin:/usr/local/bin:/usr/bin:/bin",DATABASE_URL="%(ENV_DATABASE_URL)s",REDIS_URL="%(ENV_REDIS_URL)s",ENVIRONMENT="%(ENV_ENVIRONMENT)s",COOKIE_SECURE="%(ENV_COOKIE_SECURE)s",STORAGE_PATH="%(ENV_STORAGE_PATH)s",FEED_REFRESH_INTERVAL_MINUTES="%(ENV_FEED_REFRESH_INTERVAL_MINUTES)s"
priority=100
startsecs=30

[program:worker]
command=/venv/bin/python -m arq backend.workers.settings.WorkerSettings
directory=/server
user=appuser
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stdout_logfile=/logs/worker.log
stderr_logfile=/logs/worker.err
environment=PATH="/venv/bin:/usr/local/bin:/usr/bin:/bin",DATABASE_URL="%(ENV_DATABASE_URL)s",REDIS_URL="%(ENV_REDIS_URL)s",ENVIRONMENT="%(ENV_ENVIRONMENT)s"
priority=200
startsecs=5

[program:frontend]
command=/usr/local/bin/node /app/server.js
directory=/app
user=appuser
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stdout_logfile=/logs/frontend.log
stderr_logfile=/logs/frontend.err
environment=NODE_ENV="production",PORT="2077",PATH="/venv/bin:/usr/local/bin:/usr/bin:/bin"
priority=300
startsecs=5
